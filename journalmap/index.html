<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles/styles.css">
    <title>The Map Journal</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="content">
        <header>
            <a id="logo_link" href="index.html">
                <img class="logo" src="image/The-Map-Journal-logos.jpeg" alt="Map Journal Logo">
            </a>
            <nav>
                <a href="index.html">Your Map</a>
                <img class="gps" src="image/gps.png" alt="map marker">
                <a href="yourjournal.html">Your Journal</a>
                <img class="journal" src="image/travel-journal.png" alt="journal">
                <a href="yourmemories.html">Your Memories</a>
                <img class="album" src="image/photo-al.png" alt="photo album">
            </nav>
        </header>
    </div>
    
    <div id="mapTitle">
        <h1>Your Map Journal</h1>
    </div>

    <div id="map" style="height: 400px;"></div>
    <input type="text" id="searchInput" placeholder="Search by title or keyword">
    <button onclick="searchMarkers()">Search</button>
    <button onclick="addMarker()">Add Marker</button>

    <footer>
        <p>The Map Journal &copy; 2023 - Michael Randall</p>
        <p><a href="site-plan.html">Site Plan</a></p>
        <p><a href="contactus.html">Contact Us</a></p>
        <img class="phone" src="image/phone-cont.png" alt="phone">
            <div id="share">
                <p>Share With Friends</p>
        <div class="social">
            <a href="https://facebook.com" target="_blank">
                <img src="image/facebook.png" alt="fb icon">
            </a>
            <a href="https://twitter.com" target="_blank">
                <img src="image/twitter.png" alt="twitter icon">
            </a>
            <a href="https://instagram.com" target="_blank">
                <img src="image/instagram.png" alt="instagram icon">
            </a>
        </div>
     </div>
            </footer>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([0, 0], 2);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        var markers = JSON.parse(localStorage.getItem('markers')) || [];
        var markerIdCounter = 1;
        var markerIdMap = {};

        function addMarker() {
    var title = prompt('Enter marker title:');
    if (title !== null) {  // Check if the user pressed Cancel
        var imageURL = prompt('Enter image URL (optional):');
        var popupContent = '<div>' + title + '</div>' +
            '<textarea id="markerEntry_' + markerIdCounter + '" placeholder="Enter your entry here"></textarea>' +
            '<br><button onclick="saveEntry(' + markerIdCounter + ')">Save Entry</button>' +
            '<button onclick="editEntry(' + markerIdCounter + ')">Edit Entry</button>' +
            '<button onclick="deleteMarker(' + markerIdCounter + ')">Delete Marker</button>';

        if (imageURL && imageURL.trim() !== '') {
            popupContent = '<img src="' + imageURL + '" alt="marker image" style="max-width:100%;">' + popupContent;
        }

        var popup = L.popup().setContent(popupContent);

        var marker = L.marker(map.getCenter(), { draggable: true })
            .addTo(map)
            .bindPopup(popup)
            .on('dragend', function (event) {
                updateMarkers();
            });

        var markerId = markerIdCounter++;

        markers.push({
            id: markerId,
            title: title,
            entry: '', // Initial empty entry
            imageURL: imageURL,
            latlng: marker.getLatLng()
        });

        markerIdMap[markerId] = marker;

        updateMarkers();
    }
}

        function saveEntry(markerId) {
            var entryText = document.getElementById('markerEntry_' + markerId).value;
            var marker = markerIdMap[markerId];

            var markerIndex = markers.findIndex(function (m) {
                return m.id === markerId;
            });

            if (markerIndex !== -1) {
                markers[markerIndex].entry = entryText;
            }

            marker.getPopup().setContent('<div>' + markers[markerIndex].title + '</div>' +
                '<textarea id="markerEntry_' + markerId + '" readonly>' + markers[markerIndex].entry + '</textarea>' +
                '<br><button onclick="editEntry(' + markerId + ')">Edit Entry</button>' +
                '<button onclick="deleteMarker(' + markerId + ')">Delete Marker</button>');

            updateMarkers();
        }

        function editEntry(markerId) {
            var marker = markerIdMap[markerId];
            var markerIndex = markers.findIndex(function (m) {
                return m.id === markerId;
            });

            if (markerIndex !== -1) {
                var entryText = markers[markerIndex].entry;

                marker.getPopup().setContent('<div>' + markers[markerIndex].title + '</div>' +
                    '<textarea id="markerEntry_' + markerId + '">' + entryText + '</textarea>' +
                    '<br><button onclick="saveEntry(' + markerId + ')">Save Entry</button>' +
                    '<button onclick="deleteMarker(' + markerId + ')">Delete Marker</button>');

                updateMarkers();
            }
        }

        function deleteMarker(markerId) {
            var marker = markerIdMap[markerId];

            var markerIndex = markers.findIndex(function (m) {
                return m.id === markerId;
            });

            if (markerIndex !== -1) {
                map.removeLayer(marker);
                markers.splice(markerIndex, 1);
                delete markerIdMap[markerId];
                updateMarkers();
            }
        }

        function updateMarkers() {
            markers.forEach(function (markerData) {
                var marker = markerIdMap[markerData.id];
                if (marker) {
                    markerData.latlng = marker.getLatLng();
                }
            });

            localStorage.setItem('markers', JSON.stringify(markers));
        }

        function loadMarkers() {
            for (var i = 0; i < markers.length; i++) {
                var marker = L.marker(markers[i].latlng, { draggable: true })
                    .addTo(map)
                    .bindPopup('<div>' + markers[i].title + '</div>' +
                        '<textarea id="markerEntry_' + markers[i].id + '" readonly>' + markers[i].entry + '</textarea>' +
                        '<br><button onclick="editEntry(' + markers[i].id + ')">Edit Entry</button>' +
                        '<button onclick="deleteMarker(' + markers[i].id + ')">Delete Marker</button>')
                    .on('dragend', function (event) {
                        updateMarkers();
                    });

                markerIdMap[markers[i].id] = marker;
            }
        }

        function searchMarkers() {
            var searchTerm = document.getElementById('searchInput').value.toLowerCase();

            markers.forEach(function (markerData) {
                var marker = markerIdMap[markerData.id];
                if (marker) {
                    var markerTitle = markerData.title.toLowerCase();

                    if (markerTitle.includes(searchTerm)) {
                        map.setView(markerData.latlng, 12);
                        marker.openPopup();
                    }
                }
            });
        }

        loadMarkers();
    </script>
</body>
</html>
